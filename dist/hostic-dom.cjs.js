var w=Object.defineProperty,ee=Object.prototype.hasOwnProperty,C=Object.assign,P=e=>w(e,"__esModule",{value:!0}),te=(e,t)=>{P(e);for(var r in t)w(e,r,{get:t[r],enumerable:!0})},re=(e,t)=>{if(P(e),typeof t=="object"||typeof t=="function")for(let r in t)!ee.call(e,r)&&r!=="default"&&w(e,r,{get:()=>t[r],enumerable:!0});return e},$=e=>e&&e.__esModule?e:re(w({},"default",{value:e,enumerable:!0}),e);function ne(e,t,r,i){if(typeof t=="function")return t.call(null,{props:C(C({},r),{children:i}),attrs:r,children:i,h:e.h,context:e});{let l;if(t?t.toLowerCase()==="fragment"?l=e.document.createDocumentFragment():l=e.document.createElement(t):l=e.document.createElement("div"),r)for(let[n,o]of Object.entries(r))n&&typeof n=="string"&&(n=n.toLowerCase()),n==="classname"?l.className=o:n==="on"?Object.entries(o).forEach(([s,u])=>{l.setAttribute("on"+s,u)}):o!==!1&&o!=null&&(o===!0?l.setAttribute(n,n):l.setAttribute(n,o.toString()));if(i)for(const n of i){let o=Array.isArray(n)?[...n]:[n];for(let s of o)s&&(s!==!1&&s!=null&&(typeof s!="object"?l.appendChild(e.document.createTextNode(s.toString())):l.appendChild(s)))}return l}}function N(e,t,...r){return typeof e=="object"&&(e="fragment",r=e.children,t=e.attrs),Array.isArray(t)?(r=t,t={}):t?t.attrs&&(t=C(C({},t.attrs),t),delete t.attrs):t={},{tag:e,attrs:t,children:r.flat(Infinity)}}function L(e){return e.h=function(r,i,...l){let{tag:n,attrs:o,children:s}=N(r,i,l);return ne(e,n,o,s)},e.h}function T(e){return e&&e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&apos;").replace(/"/g,"&quot;")}function I(e){return e&&e.replace(/&lt;/gi,"<").replace(/&gt;/gi,">").replace(/&quot;/gi,'"').replace(/&apos;/gi,"'").replace(/&amp;/gi,"&")}let E=[];function U(e){return e="<![CDATA["+e+"]]>",E.push(e),e}function M(e,t,r,i){const l=i&&i.length>0;let n="";if(t=t.replace(/__/g,":"),t!=="noop"){t!=="cdata"?n+=`<${t}`:n+="<![CDATA[";for(let o in r)if(o&&r.hasOwnProperty(o)){let s=r[o];if(o==="html")continue;o.toLowerCase()==="classname"&&(o="class"),o=o.replace(/__/g,":"),s===!0?n+=` ${o}="${o}"`:o==="style"&&typeof s=="object"?n+=` ${o}="${Object.keys(s).filter(u=>s[u]!=null).map(u=>{let d=s[u];return d=typeof d=="number"?d+"px":d,`${u.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}:${d}`}).join(";")}"`:s!==!1&&s!=null&&(n+=` ${o}="${T(s.toString())}"`)}if(t!=="cdata"){if(e&&!l)return n+=" />",E.push(n),n;n+=">"}if(!e&&["area","base","br","col","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"].indexOf(t)!==-1)return E.push(n),n}if(l){for(let o of i)if(o!=null&&o!==!1){Array.isArray(o)||(o=[o]);for(let s of o)E.indexOf(s)!==-1||t==="script"||t==="style"?n+=s:n+=T(s.toString())}}return r.html&&(n+=r.html),t!=="noop"&&(t!=="cdata"?n+=`</${t}>`:n+="]]>"),E.push(n),n}function h(e,t,...r){let{tag:i,attrs:l,children:n}=N(e,t,r);return M(!1,i,l,n)}h.firstLine="<!DOCTYPE html>";h.html=!0;const V=$(require("css-what"));let q={};function ie(e){let t=q[e];return t==null&&(t=V.parse(e),q[e]=t),t}function F(e,t,{debug:r=!1}={}){for(let l of ie(e)){r&&(console.log("Selector:",e),console.log("Rules:",l),console.log("Element:",t));function i(n,o){var u,d,x;let s=!1;for(let b of o){const{type:m,name:f,action:g,value:y,ignoreCase:ce=!0,data:K}=b;if(m==="attribute")g==="equals"?(s=n.getAttribute(f)===y,r&&console.log("Attribute equals",s)):g==="start"?(s=(u=n.getAttribute(f))==null?void 0:u.startsWith(y),r&&console.log("Attribute start",s)):g==="end"?(s=(d=n.getAttribute(f))==null?void 0:d.endsWith(y),r&&console.log("Attribute start",s)):g==="element"?f==="class"?(s=n.classList.contains(y),r&&console.log("Attribute class",s)):(s=(x=n.getAttribute(f))==null?void 0:x.includes(y),r&&console.log("Attribute element",s)):g==="exists"?(s=n.hasAttribute(f),r&&console.log("Attribute exists",s)):console.warn("Unknown CSS selector action",g);else if(m==="tag")s=n.tagName===f.toUpperCase(),r&&console.log("Is tag",s);else if(m==="universal")s=!0,r&&console.log("Is universal",s);else if(m==="pseudo"){if(f==="not"){let H=!0;K.forEach(Q=>{i(n,Q)||(H=!1)}),s=!H}r&&console.log("Is :not",s)}else console.warn("Unknown CSS selector type",m,e,o);if(!s)break}return s}if(i(t,l))return!0}return!1}const se=Symbol.for("nodejs.util.inspect.custom");let B={fontWeight:"bold"},R={fontStyle:"italic"},X={backgroundColor:"rgb(255, 250, 165)"},W={textDecorations:"underline"},S={textDecorations:"line-through"},oe={b:B,strong:B,em:R,i:R,mark:X,u:W,a:W,s:S,del:S,ins:X,strike:S};class a{get nodeType(){return console.error("Subclasses should define nodeType!"),0}get nodeName(){return console.error("Subclasses should define nodeName!"),""}get nodeValue(){return null}constructor(){this._parentNode=null,this._childNodes=[]}cloneNode(e=!1){let t=new this.constructor;return e&&(t._childNodes=this._childNodes.map(r=>r.cloneNode(!0)),t._fixChildNodesParent()),t}_fixChildNodesParent(){this._childNodes.forEach(e=>e._parentNode=this)}insertBefore(e,t=null){if(e!==t){let r=t?this._childNodes.indexOf(t):0;r<0&&(r=0),this._childNodes.splice(r,0,e),this._fixChildNodesParent()}}appendChild(e){if(e===this){console.warn("Cannot appendChild to self");return}if(e instanceof D&&console.warn("No defined how to append a document to a node!",e),e instanceof _)for(let t of[...e._childNodes])this.appendChild(t);else if(e instanceof a)e.remove(),this._childNodes.push(e);else try{this._childNodes.push(new c(JSON.stringify(e,null,2)))}catch(t){console.error(`The data ${e} to be added to ${this.render()} is problematic: ${t}`)}this._fixChildNodesParent()}removeChild(e){let t=this._childNodes.indexOf(e);t>=0&&(e._parentNode=null,this._childNodes.splice(t,1),this._fixChildNodesParent())}remove(){var e;return(e=this==null?void 0:this.parentNode)==null||e.removeChild(this),this}replaceChildren(...e){this._childNodes=e.map(t=>typeof t=="string"?new c(t):t.remove()),this._fixChildNodesParent()}replaceWith(...e){let t=this._parentNode;if(t){let r=this._indexInParent();r>=0&&(e=e.map(i=>typeof i=="string"?new c(i):i.remove()),t._childNodes.splice(r,1,...e),this._parentNode=null,t._fixChildNodesParent())}}_indexInParent(){return this._parentNode?this._parentNode.childNodes.indexOf(this):-1}get parentNode(){return this._parentNode}get childNodes(){return this._childNodes||[]}get firstChild(){return this._childNodes[0]}get lastChild(){return this._childNodes[this._childNodes.length-1]}get nextSibling(){let e=this._indexInParent();return e!=null&&this.parentNode.childNodes[e+1]||null}get previousSibling(){let e=this._indexInParent();return e>0&&this.parentNode.childNodes[e-1]||null}flatten({condition:e=t=>t instanceof p}={}){let t=[];e(this)&&t.push(this);for(let r of this._childNodes)t.push(...r.flatten({condition:e}));return t}render(){return""}get textContent(){return this._childNodes.map(e=>e.textContent).join("")}set textContent(e){this._childNodes=[],e&&this.appendChild(new c(e.toString()))}contains(e){return e===this?!0:this._childNodes.some(t=>t.contains(e))}get ownerDocument(){var e;return this.nodeType===a.DOCUMENT_NODE||this.nodeType===a.DOCUMENT_FRAGMENT_NODE?this:(e=this==null?void 0:this._parentNode)==null?void 0:e.ownerDocument}toString(){return`${this.nodeName}`}[se](){return`${this.constructor.name} "${this.render()}"`}}a.ELEMENT_NODE=1,a.TEXT_NODE=3,a.CDATA_SECTION_NODE=4,a.PROCESSING_INSTRUCTION_NODE=7,a.COMMENT_NODE=8,a.DOCUMENT_NODE=9,a.DOCUMENT_TYPE_NODE=10,a.DOCUMENT_FRAGMENT_NODE=11;class c extends a{get nodeType(){return a.TEXT_NODE}get nodeName(){return"#text"}get nodeValue(){return this._text||""}get textContent(){return this.nodeValue}constructor(e=""){super();this._text=e}render(){return this._text}cloneNode(e=!1){let t=super.cloneNode(e);return t._text=this._text,t}}class k extends a{getElementById(e){return this.flatten().find(t=>t._attributes.id===e)}getElementsByClassName(e){return this.flatten().filter(t=>t.classList.contains(e))}matches(e){return F(e,this)}querySelectorAll(e){return this.flatten().filter(t=>t.matches(e))}querySelector(e){return this.flatten().find(t=>t.matches(e))}parent(e){var t;return this.matches(e)?this:this.parentNode==null?null:(t=this.parentNode)==null?void 0:t.parent(e)}handle(e,t){let r=0;for(let i of this.querySelectorAll(e))t(i,r++)}}class p extends k{get nodeType(){return a.ELEMENT_NODE}get nodeName(){return this._nodeName}constructor(e="div",t={}){super();this._nodeName=(e||"").toUpperCase(),this._attributes=t||{},this._styles=null}cloneNode(e=!1){let t=super.cloneNode(e);return t._nodeName=this._nodeName,t._attributes=Object.assign({},this._attributes),t}get attributes(){return this._attributes}setAttribute(e,t){this._attributes[e]=t,this._styles=null}getAttribute(e){return this._attributes[e]}removeAttribute(e){delete this._attributes[e]}hasAttribute(e){return this._attributes[e]!=null}get style(){if(this._styles==null){let e=Object.assign({},oe[this.tagName.toLowerCase()]||{}),t=this.getAttribute("style");if(t){let r,i=/\s*([\w-]+)\s*:\s*([^;]+)/g;for(;r=i.exec(t);){let l=r[1],n=r[2].trim();e[l]=n;let o=s=>s.replace(/[A-Z]/g,"-$&").toLowerCase();e[o]=n}}this._styles=e}return this._styles}get tagName(){return this._nodeName}get id(){return this._attributes.id}set id(e){this._attributes.id=e}get src(){return this._attributes.src}set src(e){this._attributes.src=e}getElementsByTagName(e){e=e.toUpperCase();let t=this.flatten();return e!=="*"?t.filter(r=>r.tagName===e):t}get innerHTML(){return this._childNodes.map(e=>e.render(h)).join("")}set innerHTML(e){if(this.setInnerHTML)this.setInnerHTML(e);else throw"set innerHTML not implemented"}get outerHTML(){return this.render(h)}get className(){return this._attributes.class||""}set className(e){Array.isArray(e)?e=e.filter(t=>!!t).join(" "):typeof e=="object"&&(e=Object.entries(e).filter(([t,r])=>!!r).map(([t,r])=>t).join(" ")),this._attributes.class=e}get classList(){let e=this,t=(this.className||"").trim().split(/\s+/g)||[];return{contains(r){return t.includes(r)},add(r){t.includes(r)||(t.push(r),e.className=t)},remove(r){let i=t.indexOf(r);i>=0&&(t.splice(i,1),e.className=t)}}}render(e=h){return e(this.tagName.toLowerCase(),this.attributes,this.childNodes.map(t=>t.render(e)))}}class _ extends k{get nodeType(){return a.DOCUMENT_FRAGMENT_NODE}get nodeName(){return"#document-fragment"}render(e=h){return this._childNodes.map(t=>t.render(e)||[]).join("")}get innerHTML(){return this._childNodes.map(e=>e.render(h)).join("")}createElement(e,t={}){return new p(e,t)}createDocumentFragment(){return new _}createTextNode(e){return new c(e)}}class D extends _{get nodeType(){return a.DOCUMENT_NODE}get nodeName(){return"#document"}get documentElement(){return this.firstChild}}class G extends D{constructor(){super();let e=new p("html"),t=new p("body"),r=new p("head"),i=new p("title");e.appendChild(r),r.appendChild(i),e.appendChild(t),this.appendChild(e)}get body(){return this.querySelector("body")}get title(){var e;return(e=this.querySelector("title"))==null?void 0:e.textContent}set title(e){this.querySelector("title").textContent=e}get head(){return this.querySelector("head")}render(e=h){let t=super.render(e);return e.firstLine&&(t=e.firstLine+`
`+t),t}}function J(){return new D}function le(){return new G}let A=J(),ae=L({document:A});const Y=$(require("htmlparser2"));function Z(e=null){return e instanceof a?e:(e instanceof Buffer&&(e=e.toString("utf-8")),typeof e=="string"?O(e):new p("div"))}function O(e){let t=new _,r=[t],i=t,l=new Y.Parser({onopentag:(n,o)=>{let s=A.createElement(n,o);r.push(s),i.appendChild(s),i=s},ontext:function(n){var o;((o=i==null?void 0:i.lastChild)==null?void 0:o.nodeType)===a.TEXT_NODE?i.lastChild._text+=n:i.appendChild(new c(n))},onclosetag:function(n){let o=r.pop();i=r[r.length-1]}},{decodeEntities:!0});return l.write(e),l.end(),t}p.prototype.setInnerHTML=function(e){let t=O(e);this._childNodes=t._childNodes,this._fixChildNodesParent()};function j(e){let t="";for(;e.parentNode;)t+="  ",e=e.parentNode;return t.substr(2)}function z(e,t){let r="meta,link,script,p,h1,h2,h3,h4,h5,h6,blockquote,div,ul,ol,li,article,section,footer,head,body,title,nav,section,article,hr,form";e.handle(r,i=>{var s,u,d,x,b,m;let l=i;for(;l;){if(["PRE","CODE","SCRIPT","STYLE","TT"].includes(l.tagName))return;l=l.parentNode}let n=i.previousSibling;(!n||n.nodeType!==a.TEXT_NODE||!((s=n.nodeValue)==null?void 0:s.endsWith(`
`)))&&((u=i.parentNode)==null||u.insertBefore(new c(`
`),i)),(d=i.parentNode)==null||d.insertBefore(new c(j(i)),i);let o=i.nextSibling;if((!o||o.nodeType!==a.TEXT_NODE||!((x=o.nodeValue)==null?void 0:x.startsWith(`
`)))&&(o?(b=i.parentNode)==null||b.insertBefore(new c(`
`),o):(m=i.parentNode)==null||m.appendChild(new c(`
`))),i.childNodes.length){let f=i.firstChild;f.nodeType===a.TEXT_NODE&&i.insertBefore(new c(`
`+j(i)+"  ")),i.appendChild(new c(`
`+j(i)))}})}function v(e,t,...r){let{tag:i,attrs:l,children:n}=N(e,t,r);return M(!0,i,l,n)}v.firstLine='<?xml version="1.0" encoding="utf-8"?>';v.xml=!0;te(exports,{CDATA:()=>U,VDocument:()=>D,VDocumentFragment:()=>_,VElement:()=>p,VHTMLDocument:()=>G,VNode:()=>a,VNodeQuery:()=>k,VTextNode:()=>c,createDocument:()=>J,createHTMLDocument:()=>le,document:()=>A,escapeHTML:()=>T,h:()=>ae,hArgumentParser:()=>N,hFactory:()=>L,html:()=>h,parseHTML:()=>O,tidyDOM:()=>z,unescapeHTML:()=>I,vdom:()=>Z,xml:()=>v});
