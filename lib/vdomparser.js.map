{
  "version": 3,
  "sources": ["src/vdomparser.js"],
  "sourcesContent": ["// Copyright (c) 2020 Dirk Holtwick. All rights reserved. https://holtwick.de/copyright\n\nimport { VDocumentFragment, VElement, VTextNode, document } from './vdom'\nimport { VNode } from './vdom'\nimport { Parser } from 'htmlparser2'\n\n// Makes sure we operate on VNodes\nexport function vdom(obj = null) {\n  if (obj instanceof VNode) {\n    return obj\n  }\n  if (obj instanceof Buffer) {\n    obj = obj.toString('utf-8')\n  }\n  if (typeof obj === 'string') {\n    return parseHTML(obj)\n  }\n  // console.warn('Cannot convert to VDOM:', obj)\n  return new VElement('div')\n}\n\nexport function parseHTML(html) {\n  let frag = new VDocumentFragment()\n\n  let stack = [frag]\n  let currentElement = frag\n\n  let parser = new Parser({\n    onopentag: (name, attrs) => {\n      let element = document.createElement(name, attrs)\n      stack.push(element)\n      currentElement.appendChild(element)\n      currentElement = element\n    },\n    ontext: function (text) {\n      if (currentElement?.lastChild?.nodeType === VNode.TEXT_NODE) {\n        currentElement.lastChild._text += text\n      } else {\n        currentElement.appendChild(new VTextNode(text))\n      }\n    },\n    onclosetag: function (name) {\n      let element = stack.pop()\n      currentElement = stack[stack.length - 1]\n      // if (element.nodeName !== currentElement.nodeName) {\n      //   console.log('error', element, currentElement)\n      // }\n    },\n  }, { decodeEntities: true })\n  parser.write(html)\n  parser.end()\n\n  // console.log('frag', frag.innerHTML)\n\n  return frag\n}\n\nVElement.prototype.setInnerHTML = function (html) {\n  let frag = parseHTML(html)\n  this._childNodes = frag._childNodes\n  this._fixChildNodesParent()\n}\n"],
  "mappings": "AAEA;AACA;AACA;AAGO,qBAAc,MAAM;AACzB,MAAI,eAAe;AACjB,WAAO;AAAA;AAET,MAAI,eAAe;AACjB,UAAM,IAAI,SAAS;AAAA;AAErB,MAAI,OAAO,QAAQ;AACjB,WAAO,UAAU;AAAA;AAGnB,SAAO,IAAI,SAAS;AAAA;AAGf,0BAAmB;AACxB,MAAI,OAAO,IAAI;AAEf,MAAI,QAAQ,CAAC;AACb,MAAI,iBAAiB;AAErB,MAAI,SAAS,IAAI,OAAO;AAAA,IACtB,WAAW,CAAC,MAAM;AAChB,UAAI,UAAU,SAAS,cAAc,MAAM;AAC3C,YAAM,KAAK;AACX,qBAAe,YAAY;AAC3B,uBAAiB;AAAA;AAAA,IAEnB,QAAQ,SAAU;AAlCtB;AAmCM,UAAI,wDAAgB,cAAhB,mBAA2B,cAAa,MAAM;AAChD,uBAAe,UAAU,SAAS;AAAA;AAElC,uBAAe,YAAY,IAAI,UAAU;AAAA;AAAA;AAAA,IAG7C,YAAY,SAAU;AACpB,UAAI,UAAU,MAAM;AACpB,uBAAiB,MAAM,MAAM,SAAS;AAAA;AAAA,KAKvC,CAAE,gBAAgB;AACrB,SAAO,MAAM;AACb,SAAO;AAIP,SAAO;AAAA;AAGT,SAAS,UAAU,eAAe,SAAU;AAC1C,MAAI,OAAO,UAAU;AACrB,OAAK,cAAc,KAAK;AACxB,OAAK;AAAA;",
  "names": []
}
